name: Deploy to HuggingFace Spaces

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: Build HF Space staging directory
        run: |
          mkdir -p hf_space/examples hf_space/demo

          # Entry point
          cp examples/app.py hf_space/app.py

          # Example modules (as a Python package) â€” copy all .py files
          touch hf_space/examples/__init__.py
          cp examples/*.py hf_space/examples/

          # Gradio UI code
          cp -r examples/demo/. hf_space/demo/

          # Tracked repo files (no heredocs)
          cp examples/requirements.txt hf_space/requirements.txt
          cp examples/README.md hf_space/README.md

      - name: Push to HuggingFace Spaces
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          cd hf_space
          git init --initial-branch=main
          git config user.email "github-actions@github.com"
          git config user.name "GitHub Actions"
          git add -A
          git commit -m "Deploy from GitHub ${GITHUB_SHA::7}"
          git push --force https://aonel:$HF_TOKEN@huggingface.co/spaces/askmanu/acorn main
